<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        #startBtn { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; padding: 20px; background: #FF1493; color: white; border-radius: 50px; border: none; font-size: 1.2rem; }
        #status { position: fixed; top: 10px; width: 100%; text-align: center; color: white; z-index: 100; font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="status">Click the button to start the MR experience</div>
    <button id="startBtn">START SURPRISE üéÅ</button>

    <a-scene webxr="requiredFeatures: hit-test, local-floor; optionalFeatures: dom-overlay; overlayElement: #status;" renderer="alpha: true;">
        <a-assets>
            <video id="giftVideo" src="your-video.mp4" loop crossorigin="anonymous" playsinline></video>
        </a-assets>

        <a-video id="arVideo" src="#giftVideo" width="1.6" height="0.9" position="0 1.6 -1.5" visible="false"></a-video>

        <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <video id="input_video" style="display:none;"></video>

    <script>
        const arVideo = document.querySelector('#arVideo');
        const startBtn = document.querySelector('#startBtn');
        const status = document.querySelector('#status');
        const videoFile = document.querySelector('#giftVideo');
        const inputVideo = document.getElementById('input_video');

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });

        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                
                // MOVE: Video follows the middle finger base (Landmark 9)
                // We map normalized 0-1 coords to 3D space
                const x = (lm[9].x - 0.5) * -2.5; 
                const y = (0.5 - lm[9].y) * 2 + 1.5;
                arVideo.setAttribute('position', `${x} ${y} -1.5`);

                // ZOOM: Distance between Thumb(4) and Index(8)
                const dist = Math.sqrt(Math.pow(lm[4].x - lm[8].x, 2) + Math.pow(lm[4].y - lm[8].y, 2));
                const scale = Math.max(0.5, dist * 6); 
                arVideo.setAttribute('scale', `${scale} ${scale} 1`);

                if (!arVideo.getAttribute('visible')) {
                    arVideo.setAttribute('visible', 'true');
                    videoFile.play();
                    status.innerText = "‚ù§Ô∏è Happy 5th Anniversary! ‚ù§Ô∏è";
                }
            }
        });

        startBtn.addEventListener('click', () => {
            startBtn.style.display = 'none';
            status.innerText = "Finding your hand...";
            
            // Start the camera for MediaPipe
            const camera = new Camera(inputVideo, {
                onFrame: async () => { await hands.send({image: inputVideo}); },
                width: 1280, height: 720
            });
            camera.start();
        });
    </script>
</body>
</html>
</body>
</html>

