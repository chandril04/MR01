<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hand Controlled WebAR</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://unpkg.com/aframe-chromakey-material/dist/aframe-chromakey-material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
  </head>
  
  <body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; z-index:1000; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
      <h2>Hand Gesture AR</h2>
      <p>Point at your image target to start</p>
      <button id="start-btn" style="padding:15px 30px; font-size:18px; border-radius:10px; border:none; background:#007bff; color:white; cursor:pointer;">START CAMERA</button>
    </div>

    <a-scene mindar-image="imageTargetSrc: ./target.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-assets>
        <video id="vid" src="video.mp4" loop="true" muted playsinline crossorigin="anonymous"></video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
        <a-video id="ar-video" src="#vid" width="1" height="0.6" 
                 material="shader: chromakey; color: 0.1 0.9 0.2" 
                 position="0 0 0">
        </a-video>
      </a-entity>
    </a-scene>

    <script>
      const video = document.getElementById('vid');
      const arVideo = document.querySelector('#ar-video');
      const overlay = document.getElementById('overlay');
      const startBtn = document.getElementById('start-btn');

      // 1. Initial Start Click
      startBtn.addEventListener('click', () => {
        overlay.style.display = 'none';
        video.play().catch(e => console.log("Video wait for target"));
        setupHandTracking();
      });

      function setupHandTracking() {
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        
        hands.setOptions({
          maxNumHands: 1,
          modelComplexity: 1,
          minDetectionConfidence: 0.7,
          minTrackingConfidence: 0.7
        });

        hands.onResults((results) => {
          if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const landmarks = results.multiHandLandmarks[0];

            // GESTURE: Position Control
            // Index finger tip (Landmark 8) moves the video
            const x = (landmarks[8].x - 0.5) * 2;
            const y = (0.5 - landmarks[8].y) * 2;
            arVideo.setAttribute('position', `${x} ${y} 0`);

            // GESTURE: Scale/Play Control
            // If hand is Open (Middle finger tip 12 vs base 9)
            const isOpen = landmarks[12].y < landmarks[9].y;
            if (isOpen) {
              video.play();
              arVideo.setAttribute('scale', '1.2 1.2 1.2');
            } else {
              video.pause();
              arVideo.setAttribute('scale', '0.8 0.8 0.8');
            }
          }
        });

        // Use MindAR's video feed for MediaPipe
        const startFeed = () => {
          const mindVideo = document.querySelector('video');
          if (mindVideo) {
            const camera = new Camera(mindVideo, {
              onFrame: async () => { await hands.send({image: mindVideo}); },
              width: 640, height: 480
            });
            camera.start();
          } else {
            setTimeout(startFeed, 1000);
          }
        };
        startFeed();
      }
    </script>
  </body>
</html>





