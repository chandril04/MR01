<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Anniversary MR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <button id="startButton" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:9999; padding:20px; background:#FF69B4; color:white; border:none; border-radius:10px; font-size:20px;">
        OPEN THE GIFT ğŸ
    </button>

    <a-scene>
        <a-assets>
            <video id="giftVideo" src="deb01.mp4" crossorigin="anonymous" playsinline></video>
        </a-assets>

        <a-video id="videoScreen" src="#giftVideo" position="0 1.6 -2" width="2" height="1.1" visible="false"></a-video>
        
        <a-text id="statusText" value="Wait for camera..." position="0 2.2 -2" align="center" color="white" width="4"></a-text>

        <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <video id="input_video" style="display:none;"></video>

    <script>
        const videoElement = document.getElementById('input_video');
        const startBtn = document.getElementById('startButton');
        const statusText = document.getElementById('statusText');
        const arVideo = document.getElementById('videoScreen');
        const giftVidFile = document.getElementById('giftVideo');

        // 1. Initialize Hand Tracking
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });

        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                // Hand detected! Show the video and play
                if (arVideo.getAttribute('visible') === false) {
                    statusText.setAttribute('value', 'Happy 5th Anniversary! â¤ï¸');
                    arVideo.setAttribute('visible', 'true');
                    giftVidFile.play();
                }
            }
        });

        // 2. Start Everything on Click
        startBtn.addEventListener('click', () => {
            startBtn.style.display = 'none';
            statusText.setAttribute('value', 'Now show your hand to the camera!');
            
            const camera = new Camera(videoElement, {
                onFrame: async () => { await hands.send({image: videoElement}); },
                width: 640, height: 480
            });
            camera.start();
        });
    </script>
</body>
</html>
